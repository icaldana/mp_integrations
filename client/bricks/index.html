<html>

<head>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <script type="text/javascript">
        var brickFlipper = true;
        var controller = false;
        const mp = new MercadoPago('APP_USR-1d1ce135-5976-4838-938e-64d5ec7198d4');
        const bricksBuilder = mp.bricks();
        function handleClick() {

            controller && controller.unmount();
            document.querySelector('#button').disabled = true;
            if (!brickFlipper) {
                const renderWalletBrick = async (bricksBuilder) => {
                    const settings = {
                        initialization: {
                            preferenceId: "285966773-51ba5ea0-eee5-4180-96a8-795ee3933c28",
                            redirectMode: 'blank'
                        },
                        callbacks: {
                            onReady: () => {
                                document.querySelector('#button').disabled = false;
                            },
                        }

                    };
                    controller = await bricksBuilder.create(
                        'wallet',
                        'brickContainer',
                        settings,
                    );

                };
                renderWalletBrick(bricksBuilder);
            } else {
                const renderCardPaymentBrick = async (bricksBuilder) => {

                    const settings = {
                        initialization: {
                            amount: 1000,
                        },
                        customization: {
                            visual: {
                                style: {
                                    theme: 'default',
                                },
                            },
                        },
                        callbacks: {
                            onSubmit: (cardFormData) => {
                                return new Promise((resolve, reject) => {
                                    fetch("http://localhost:8000/process_payment", {
                                        method: "POST",
                                        headers: {
                                            "Content-Type": "application/json",
                                        },
                                        body: JSON.stringify(cardFormData)
                                    })
                                        .then(resp => resp.json())
                                        .then((response) => {
                                            console.log(response);
                                            resolve();
                                        })
                                        .catch((error) => {
                                            console.log(error);
                                            reject();
                                        })
                                });
                            },
                            onReady: () => {
                                document.querySelector('#button').disabled = false;
                            },
                            onError: (error) => { }
                        }
                    }
                    controller = await bricksBuilder.create('cardPayment', 'brickContainer', settings);
                };
                renderCardPaymentBrick(bricksBuilder);
            }
            brickFlipper = !brickFlipper;
        }
    </script>
</head>

<body>
    <button id='button' onclick="handleClick()">Toggle brick</button>
    <div id="brickContainer"></div>

</body>

</html>